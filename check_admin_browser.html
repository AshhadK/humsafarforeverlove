<!DOCTYPE html>
<html>
<head>
    <title>Admin User Check</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Admin User Database Check</h1>
    <div id="output"></div>
    
    <script>
        const supabaseUrl = 'https://znmrwfqycwlnrefksdaq.supabase.co/'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpubXJ3ZnF5Y3dsbnJlZmtzZGFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MzkxMTYsImV4cCI6MjA3MjMxNTExNn0.KcyAzNQIYvql0ZhEYf_0GKRk_xMC_1VbntTkxUmXlc4'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        async function checkAdminUser() {
            const output = document.getElementById('output')
            output.innerHTML = '<p>üîç Checking admin user...</p>'
            
            try {
                // Check admin_users table
                console.log('Checking admin_users table...')
                const { data: adminUsers, error: adminError } = await supabase
                    .from('admin_users')
                    .select('*')
                    .eq('email', 'admin@gmail.com')
                
                if (adminError) {
                    output.innerHTML += `<p>‚ùå Error: ${adminError.message}</p>`
                    if (adminError.code === '42P01') {
                        output.innerHTML += '<p>üí° admin_users table does not exist!</p>'
                        output.innerHTML += '<p>Create it in Supabase Dashboard SQL Editor:</p>'
                        output.innerHTML += `<pre>CREATE TABLE admin_users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    email TEXT NOT NULL,
    role TEXT DEFAULT 'admin',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE admin_users ENABLE ROW LEVEL SECURITY;</pre>`
                    }
                    return
                }
                
                if (!adminUsers || adminUsers.length === 0) {
                    output.innerHTML += '<p>‚ùå Admin user not found in admin_users table</p>'
                    output.innerHTML += '<p>üí° Run this SQL in Supabase Dashboard:</p>'
                    output.innerHTML += `<pre>INSERT INTO admin_users (user_id, email, role, created_at, updated_at)
VALUES (
    'fd85c89b-80a3-4451-9bfa-7363283ac42a',
    'admin@gmail.com',
    'admin',
    NOW(),
    NOW()
);</pre>`
                    return
                }
                
                output.innerHTML += '<p>‚úÖ Admin user found in admin_users table!</p>'
                output.innerHTML += `<pre>${JSON.stringify(adminUsers[0], null, 2)}</pre>`
                
                // Now check if we can authenticate
                output.innerHTML += '<p>üîê Testing authentication...</p>'
                
                // Try to sign in (this will fail if user doesn't exist in auth.users)
                const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                    email: 'admin@gmail.com',
                    password: 'test123' // This will fail, but we can see the error
                })
                
                if (authError) {
                    if (authError.message.includes('Invalid login credentials')) {
                        output.innerHTML += '<p>‚ö†Ô∏è User exists but password is wrong (this is expected)</p>'
                        output.innerHTML += '<p>‚úÖ Authentication system is working!</p>'
                        output.innerHTML += '<p>üí° Set the correct password in Supabase Dashboard > Authentication > Users</p>'
                    } else if (authError.message.includes('Email not confirmed')) {
                        output.innerHTML += '<p>‚ö†Ô∏è User exists but email not confirmed</p>'
                        output.innerHTML += '<p>üí° Confirm the user in Supabase Dashboard</p>'
                    } else {
                        output.innerHTML += `<p>‚ùå Auth error: ${authError.message}</p>`
                        if (authError.message.includes('User not found')) {
                            output.innerHTML += '<p>üí° Create user in Supabase Dashboard > Authentication > Users</p>'
                            output.innerHTML += '<p>Email: admin@gmail.com</p>'
                            output.innerHTML += '<p>Password: [your choice]</p>'
                            output.innerHTML += '<p>Auto Confirm User: Yes</p>'
                        }
                    }
                }
                
            } catch (error) {
                output.innerHTML += `<p>‚ùå Unexpected error: ${error.message}</p>`
                console.error('Error:', error)
            }
        }
        
        // Run check when page loads
        checkAdminUser()
    </script>
</body>
</html>